```php
<?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;
use Symfony\Component\HttpFoundation\Response;

class EnsureTokenIsValid
{
    /**
     * Handle an incoming request.
     *
     * @param  \Closure(\Illuminate\Http\Request): (\Symfony\Component\HttpFoundation\Response)  $next
     */
    public function handle(Request $request, Closure $next): Response
    {
        if ($request->input('token') !== 'my-secret-token') {
            return redirect('home');
        }

        return $next($request);
    }
}
```

Laravel-ржПрж░ **middleware** ржХрзНрж▓рж╛рж╕рзЗ `Closure $next` ржПржмржВ `$next($request)` ржжрзБржЯрж┐ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржзрж╛рж░ржгрж╛ред ржЖржорж┐ ржПржЧрзБрж▓рзЛрж░ ржмрзНржпрж╛ржЦрзНржпрж╛ ржирж┐ржЪрзЗ ржжрж┐ржЪрзНржЫрж┐:

### рзз. **`Closure $next` ржПрж░ ржорж╛ржирзЗ:**

-   **`Closure`** ржПржХржЯрж┐ PHP рж╢ржмрзНржж, ржпрж╛ рж╕рж╛ржзрж╛рж░ржгржд "ржПржирзЛржирж┐ржорж╛рж╕ ржлрж╛ржВрж╢ржи" ржмрж╛ "ржХрж▓ржмрзНржпрж╛ржХ ржлрж╛ржВрж╢ржи" рж╣рж┐рж╕рзЗржмрзЗ ржкрж░рж┐ржЪрж┐рждред ржПржЯрж┐ ржПржХржЯрж┐ ржлрж╛ржВрж╢ржи ржпрж╛ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржХрж╛ржЬ рж╕ржорзНржкрж╛ржжржи ржХрж░рзЗ ржПржмржВ ржкрж░рзЗ ржЕржирзНржп ржХрж┐ржЫрзБ ржлрж╛ржВрж╢ржирзЗ ржкрж╛ржарж╛ржирзЛ рж╣ржпрж╝ред
-   Laravel Middleware-ржП `Closure $next` рж╣рж▓ рж╕рзЗржЗ ржлрж╛ржВрж╢ржи ржмрж╛ ржХрж▓ржмрзНржпрж╛ржХ ржпрзЗржЯрж┐ **ржкрж░ржмрж░рзНрждрзА рж╕рзНржЯрзЗржкрзЗ рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ ржкрж╛ржарж╛рждрзЗ ржмрзНржпржмрж╣рзГржд рж╣ржпрж╝**ред ржЖржкржирж┐ ржпрзЗржнрж╛ржмрзЗ middleware-ржПрж░ ржоржзрзНржпрзЗ ржХрж┐ржЫрзБ ржХрж╛рж╕рзНржЯржо рж▓ржЬрж┐ржХ рж▓рж┐ржЦрзЗ рждрж╛рж░ ржкрж░рзЗ рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯржХрзЗ `next` ржлрж╛ржВрж╢ржирзЗрж░ ржорж╛ржзрзНржпржорзЗ ржЕржирзНржп ржоржбрж┐ржЙрж▓ ржмрж╛ рж░рж╛ржЙржЯрзЗ ржкрж╛ржарж╛ржиред

### рзи. **`$next($request)` ржПрж░ ржорж╛ржирзЗ:**

-   **`$next($request)`** рж╣ржЪрзНржЫрзЗ рж╕рзЗржЗ ржлрж╛ржВрж╢ржи ржХрж▓ ржпрж╛ **рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯржЯрж┐ ржкрж░ржмрж░рзНрждрзА middleware ржмрж╛ рж░рж╛ржЙржЯрзЗрж░ ржХрж╛ржЫрзЗ ржкрж╛ржарж╛ржпрж╝**ред ржПржЯрж┐ middleware ржЪрзЗржЗржирзЗрж░ ржоржзрзНржпрзЗ ржкрж░ржмрж░рзНрждрзА рж╕рзНржЯрзЗржкрзЗ рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ ржкрж╛ржарж╛ржирзЛрж░ ржжрж╛рзЯрж┐рждрзНржм ржкрж╛рж▓ржи ржХрж░рзЗред
-   ржпржжрж┐ `handle()` ржорзЗржержбрзЗ ржХрзЛржирзЛ рж╢рж░рзНржд ржкрзВрж░рзНржг ржирж╛ рж╣ржпрж╝, ржЕрж░рзНржерж╛рзО, ржпржжрж┐ `token` ржнрзБрж▓ рж╣ржпрж╝, рждрж╛рж╣рж▓рзЗ ржПржЗ `next` ржлрж╛ржВрж╢ржи ржХрж▓ ржХрж░рж╛ рж╣ржпрж╝ ржирж╛ ржПржмржВ ржЖржкржирж┐ рж░рж┐ржбрж╛ржЗрж░рзЗржХрзНржЯ рж╣рждрзЗ ржкрж╛рж░рзЗржиред ржХрж┐ржирзНрждрзБ ржпржжрж┐ рж╢рж░рзНржд ржкрзВрж░рзНржг рж╣ржпрж╝, рждржЦржи рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯржЯрж┐ ржкрж░ржмрж░рзНрждрзА рж╕рзНржЯрзЗржкрзЗ ржкрзМржБржЫрж╛рждрзЗ `next($request)` ржХрж▓ ржХрж░рж╛ рж╣ржпрж╝ред

---

### ржЙржжрж╛рж╣рж░ржг:

```php
public function handle(Request $request, Closure $next): Response
{
    if ($request->input('token') !== 'my-secret-token') {
        return redirect('home');
    }

    return $next($request);
}
```

ржПржЦрж╛ржирзЗ:

-   ржпржжрж┐ `token` ржорзЗржЪ ржирж╛ ржХрж░рзЗ, **`redirect('home')`** ржХрж╛рж░рзНржпржХрж░ рж╣ржмрзЗ ржПржмржВ рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯржЯрж┐ ржЖрж░ ржкрж░ржмрж░рзНрждрзА middleware ржмрж╛ рж░рж╛ржЙржЯ ржП ржпрж╛ржмрзЗ ржирж╛ред
-   ржпржжрж┐ `token` рж╕ржарж┐ржХ ржерж╛ржХрзЗ, рждрж╛рж╣рж▓рзЗ **`$next($request)`** ржХрж▓ рж╣ржмрзЗ ржПржмржВ рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯржЯрж┐ ржкрж░ржмрж░рзНрждрзА middleware ржмрж╛ рж░рж╛ржЙржЯрзЗрж░ ржХрж╛ржЫрзЗ ржкрзМржБржЫрж╛ржмрзЗред

ржПржЯрж┐ ржорзВрж▓ржд middleware ржЪрзЗржЗржи ржмржЬрж╛ржпрж╝ рж░рж╛ржЦрждрзЗ рж╕рж╣рж╛ржпрж╝ржХ, ржпрзЗржЦрж╛ржирзЗ ржПржХрж╛ржзрж┐ржХ middleware ржПржХрзЗ ржЕржкрж░рзЗрж░ ржкрж░ ржХрж╛ржЬ ржХрж░рзЗред

ржЖржЪрзНржЫрж╛, ржЖржорж┐ ржПржХржжржо рж╕рж╣ржЬржнрж╛ржмрзЗ ржмрзНржпрж╛ржЦрзНржпрж╛ ржХрж░ржЫрж┐ред ржЖржкржирж┐ Laravel-ржП **middleware** ржирж┐ржпрж╝рзЗ ржХрж╛ржЬ ржХрж░ржЫрзЗржиред ржПржЦрж╛ржирзЗ `Closure $next` ржПржмржВ `$next($request)` ржХрзА ржХрж░рзЗ, рж╕рзЗржЯрж┐ рж╕рж╣ржЬржнрж╛ржмрзЗ ржмрж▓рж┐ред

---

### рзз. **Middleware ржХрзА?**

Middleware рж╣рж▓ Laravel-ржПрж░ ржПржоржи ржПржХржЯрж┐ ржЬрж┐ржирж┐рж╕ ржпрж╛ ржЖржкржирж╛рж░ рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ (ржпрзЗржоржи: ржкрзЗржЬ ржжрзЗржЦрж╛рж░ ржЬржирзНржп рж╕рж╛рж░рзНржнрж╛рж░рзЗ ржпрж╛ржУржпрж╝рж╛) ржПржмржВ рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ рж░рзЗрж╕ржкржирзНрж╕ (ржпрзЗржоржи: ржкрзЗржЬрзЗрж░ HTML) ржПрж░ ржорж╛ржЭржЦрж╛ржирзЗ ржжрж╛ржБржбрж╝рж┐ржпрж╝рзЗ ржХрж┐ржЫрзБ ржХрж╛ржЬ ржХрж░рзЗред ржЙржжрж╛рж╣рж░ржг:

-   ржЖржкржирж╛рж░ ржкрзЗржЬ ржжрзЗржЦрж╛рж░ ржЖржЧрзЗ ржЪрзЗржХ ржХрж░ржмрзЗ ржЖржкржирж┐ рж▓ржЧ-ржЗржи ржХрж░рзЗржЫрзЗржи ржХрж┐ржирж╛ред
-   ржЪрзЗржХ ржХрж░ржмрзЗ ржЖржкржирж╛рж░ ржЕржирзБржорждрж┐ ржЖржЫрзЗ ржХрж┐ржирж╛ред
-   ржЯрзЛржХрзЗржи рж╕ржарж┐ржХ ржХрж┐ржирж╛ред

---

### рзи. **`Closure $next` ржПрж░ ржХрж╛ржЬ:**

Laravel-ржП `Closure $next` рж╣рж▓ рж╕рзЗржЗ ржжрж░ржЬрж╛, ржпрж╛ рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯржХрзЗ ржкрж░ржмрж░рзНрждрзА ржзрж╛ржкрзЗ (ржпрзЗржоржи, ржЕржирзНржп middleware ржмрж╛ рж░рж╛ржЙржЯ) ржкрж╛ржарж┐ржпрж╝рзЗ ржжрзЗржпрж╝ред ржпржжрж┐ ржжрж░ржЬрж╛ржЯрж┐ ржмржирзНржз ржерж╛ржХрзЗ, рждрж╛рж╣рж▓рзЗ рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ ржкрж░ржмрж░рзНрждрзА ржзрж╛ржкрзЗ ржпрзЗрждрзЗ ржкрж╛рж░ржмрзЗ ржирж╛ред

---

### рзй. **`$next($request)` ржПрж░ ржХрж╛ржЬ:**

ржПржЯрж┐ рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯржХрзЗ ржжрж░ржЬрж╛ ржжрж┐ржпрж╝рзЗ ржмрж╛ржЗрж░рзЗ ржкрж╛ржарж╛ржпрж╝ред ржЕрж░рзНржерж╛рзО, ржЖржкржирж╛рж░ middleware ржЪрзЗржХ ржХрж░рзЗ ржмрж▓ржмрзЗ:

-   **"ржарж┐ржХ ржЖржЫрзЗ, рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ рж╕ржарж┐ржХ, ржкрж░ржмрж░рзНрждрзА ржзрж╛ржкрзЗ ржпрж╛ржУред"**
-   ржирж╛рж╣рж▓рзЗ ржПржЯрж┐ рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯржХрзЗ ржЖржЯржХрзЗ ржжрзЗржмрзЗ ржПржмржВ ржЕржирзНржп ржХрзЛржерж╛ржУ рж░рж┐ржбрж╛ржЗрж░рзЗржХрзНржЯ ржХрж░ржмрзЗред

---

### ржЙржжрж╛рж╣рж░ржг рж╕рж╣ржЬржнрж╛ржмрзЗ:

ржзрж░рзБржи, ржЖржкржирж┐ ржПржХржЯрж┐ рж░рзЗрж╕рзНржЯрзБрж░рзЗржирзНржЯрзЗ ржврзБржХрждрзЗ ржЪрж╛ржиред ржжрж░ржЬрж╛рж░ рж╕рж╛ржоржирзЗ ржПржХржЬржи ржЧрж╛рж░рзНржб ржЖржЫрзЗред ржЧрж╛рж░рзНржб ржЯрзЛржХрзЗржи ржЪрзЗржХ ржХрж░ржмрзЗ:

-   ржпржжрж┐ ржЖржкржирж╛рж░ ржЯрзЛржХрзЗржи ржарж┐ржХ ржерж╛ржХрзЗ, рж╕рзЗ ржмрж▓ржмрзЗ "рждрзЛржорж╛рж░ ржЯрзЛржХрзЗржи ржарж┐ржХ ржЖржЫрзЗ, ржврзБржХрзЗ ржкржбрж╝рзЛред"
-   ржпржжрж┐ ржЯрзЛржХрзЗржи ржнрзБрж▓ рж╣ржпрж╝, рж╕рзЗ ржмрж▓ржмрзЗ "рждрзЛржорж╛рж░ ржЯрзЛржХрзЗржи ржнрзБрж▓ред рждрзБржорж┐ ржврзБржХрждрзЗ ржкрж╛рж░ржмрзЗ ржирж╛ред"

Laravel-ржП middleware ржарж┐ржХ ржПржЗ ржХрж╛ржЬржЯрж╛ржЗ ржХрж░рзЗред

---

### ржХрзЛржб ржЙржжрж╛рж╣рж░ржг ржмрзНржпрж╛ржЦрзНржпрж╛:

```php
if ($request->input('token') !== 'my-secret-token') {
    return redirect('home'); // ржпржжрж┐ ржЯрзЛржХрзЗржи ржнрзБрж▓ рж╣ржпрж╝, рждржЦржи ржЕржирзНржп ржкрзЗржЬрзЗ ржкрж╛ржарж╛ржмрзЗ
}

return $next($request); // ржЯрзЛржХрзЗржи ржарж┐ржХ ржерж╛ржХрж▓рзЗ ржкрж░ржмрж░рзНрждрзА ржзрж╛ржкрзЗ ржпрж╛ржмрзЗ
```

-   **`if` ржЪрзЗржХ ржХрж░рзЗ:** ржЯрзЛржХрзЗржи ржарж┐ржХ ржЖржЫрзЗ ржХрж┐ржирж╛ред
-   **`redirect('home')`:** ржпржжрж┐ ржЯрзЛржХрзЗржи ржнрзБрж▓ рж╣ржпрж╝, ржЖржкржирж╛ржХрзЗ ржЕржирзНржп ржкрзЗржЬрзЗ (ржпрзЗржоржи: `home`) ржкрж╛ржарж┐ржпрж╝рзЗ ржжрзЗржпрж╝ред
-   **`$next($request)`:** ржпржжрж┐ ржЯрзЛржХрзЗржи ржарж┐ржХ ржерж╛ржХрзЗ, рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ ржкрж░ржмрж░рзНрждрзА ржзрж╛ржкрзЗ (ржпрзЗржоржи, ржЕржирзНржп middleware ржмрж╛ рж░рж╛ржЙржЯ) ржкрж╛ржарж╛ржпрж╝ред

---

### рж╕рж╣ржЬ ржХржерж╛:

-   **`Closure $next`** рж╣рж▓ ржжрж░ржЬрж╛ред
-   **`$next($request)`** ржжрж░ржЬрж╛ ржЦрзБрж▓рзЗ рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯржХрзЗ ржмрж╛ржЗрж░рзЗ ржкрж╛ржарж╛ржирзЛрж░ ржХрж╛ржЬ ржХрж░рзЗред
-   ржЖрж░ ржпржжрж┐ ржжрж░ржЬрж╛ ржирж╛ ржЦрзЛрж▓рзЗ (ржпрзЗржоржи: ржЯрзЛржХрзЗржи ржнрзБрж▓), рждржЦржи ржЖржкржирж┐ ржЕржирзНржпржжрж┐ржХрзЗ (ржпрзЗржоржи: `home` ржкрзЗржЬ) ржЪрж▓рзЗ ржпрж╛ржмрзЗржиред

ржЖржкржирж╛рж░ ржкрзНрж░рж╢рзНржиржЯрж╛ ржЦрзБржм ржнрж╛рж▓рзЛ, ржПржмржВ ржПржХржжржо рж╕ржарж┐ржХ ржЬрж╛рзЯржЧрж╛рзЯ рж╣рж╛ржд ржжрж┐рзЯрзЗржЫрзЗржиред ржЖржорж┐ ржПржЦржи ржПржХржжржо ржзрж╛ржкрзЗ ржзрж╛ржкрзЗ рж╕ржм ржмрзНржпрж╛ржЦрзНржпрж╛ ржХрж░ржЫрж┐ред

---

### рзз. **`Closure $next` ржПрж░ ржлрж╛ржВрж╢ржи ржмржбрж┐ ржХрзЛржерж╛рзЯ?**

`Closure $next` рж╣рж▓ ржПржХржЯрж┐ **ржХрж▓ржмрзНржпрж╛ржХ ржлрж╛ржВрж╢ржи** ржпрж╛ Laravel ржЖржорж╛ржжрзЗрж░ ржЬржирзНржп ржЖржЧрзЗ ржерзЗржХрзЗржЗ рждрзИрж░рж┐ ржХрж░рзЗ рж░рзЗржЦрзЗржЫрзЗред

Laravel-ржП ржпржЦржи middleware рждрзИрж░рж┐ ржХрж░рж╛ рж╣ржпрж╝, рждржЦржи Laravel рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ ржкрзНрж░рж╕рзЗрж╕ ржХрж░рж╛рж░ ржкрж░ржмрж░рзНрждрзА ржзрж╛ржкрзЗрж░ ржЬржирзНржп ржПржЗ `$next` ржлрж╛ржВрж╢ржиржЯрж┐ **ржЕржЯрзЛржорзЗржЯрж┐ржХ ржкрж╛рж╕ ржХрж░рзЗ**ред ржПржЯрж┐ **Laravel ржлрзНрж░рзЗржоржУржпрж╝рж╛рж░рзНржХрзЗрж░ ржЕржВрж╢**, ржЖрж░ ржЖржкржирж╛ржХрзЗ ржПржЯрж┐ рждрзИрж░рж┐ ржХрж░рждрзЗ рж╣ржпрж╝ ржирж╛ред

ржП ржХрж╛рж░ржгрзЗржЗ `$next`-ржПрж░ ржлрж╛ржВрж╢ржи ржмржбрж┐ ржЖржкржирж╛рж░ middleware-ржП рж╕рж░рж╛рж╕рж░рж┐ ржжрзЗржЦрждрзЗ ржкрж╛ржмрзЗржи ржирж╛ред рждржмрзЗ ржЖржкржирж┐ ржпржжрж┐ Laravel-ржПрж░ рж╕рзЛрж░рзНрж╕ ржХрзЛржб ржжрзЗржЦрзЗржи, рж╕рзЗржЦрж╛ржирзЗ `$next` ржЖрж╕рж▓рзЗ ржХрзА ржХрж░рзЗ, рж╕рзЗржЯрж┐ ржжрзЗржЦрждрзЗ ржкрж╛рж░ржмрзЗржиред

---

### рзи. **`Closure` ржХрзАржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ?**

PHP-рждрзЗ **`Closure`** рж╣ржЪрзНржЫрзЗ **ржПржирзЛржирж┐ржорж╛рж╕ ржлрж╛ржВрж╢ржи** (ржирж╛ржорж╣рзАржи ржлрж╛ржВрж╢ржи), ржпрж╛ ржХрзЛржирзЛ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржирж╛ржо ржЫрж╛ржбрж╝рж╛ржЗ рждрзИрж░рж┐ ржХрж░рж╛ рж╣ржпрж╝ред `function` ржХрзАржУржпрж╝рж╛рж░рзНржб ржЫрж╛ржбрж╝рж╛ **`Closure` ржлрж╛ржВрж╢ржи рждрзИрж░рж┐ ржХрж░рж╛ ржпрж╛ржпрж╝ ржирж╛**, рждржмрзЗ ржПржЯрж┐ Laravel-ржПрж░ ржоржд ржлрзНрж░рзЗржоржУржпрж╝рж╛рж░рзНржХрзЗ рж╕рж╣ржЬрзЗржЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ ржпрж╛ржпрж╝ред

#### ржЙржжрж╛рж╣рж░ржг:

```php
// ржПржХржЯрж┐ рж╕рж╛ржзрж╛рж░ржг Closure ржлрж╛ржВрж╢ржи
$myClosure = function ($name) {
    return "Hello, $name!";
};

// Closure ржХрж▓ ржХрж░рж╛
echo $myClosure('Laravel');
// ржЖржЙржЯржкрзБржЯ: Hello, Laravel!
```

Laravel middleware-ржП `Closure $next` рж╣ржЪрзНржЫрзЗ ржПржоржи ржПржХржЯрж┐ ржлрж╛ржВрж╢ржи, ржпрж╛ **ржЖржЧрзЗ ржерзЗржХрзЗржЗ ржбрж┐ржлрж╛ржЗржи ржХрж░рж╛ ржЖржЫрзЗ**, ржПржмржВ ржПржЯрж┐ middleware ржЪрзЗржЗржи ржорзЗржЗржиржЯрзЗржЗржи ржХрж░рж╛рж░ ржЬржирзНржп ржХрж╛ржЬ ржХрж░рзЗред

---

### рзй. **`Closure $next` рждрзИрж░рж┐ ржХрж░рж╛ рж╣ржпрж╝ Laravel-ржП, ржЖржкржирж╛ржХрзЗ ржиржпрж╝:**

Laravel ржпржЦржи middleware ржкрзНрж░рж╕рзЗрж╕ ржХрж░рзЗ:

1. ржкрзНрж░ржержорзЗ **рж░рж╛ржЙржЯ ржлрж╛ржЗрж▓ ржерзЗржХрзЗ** middleware ржХрж▓ рж╣ржпрж╝ред
2. ржПрж░ржкрж░ Laravel `$next` ржлрж╛ржВрж╢ржиржХрзЗ middleware-ржПрж░ ржХрж╛ржЫрзЗ ржкрж╛ржарж╛ржпрж╝ред
3. `$next` ржлрж╛ржВрж╢ржирзЗрж░ ржХрж╛ржЬ рж╣ржЪрзНржЫрзЗ **ржкрж░ржмрж░рзНрждрзА middleware ржмрж╛ рж░рж╛ржЙржЯ**-ржП рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ ржкрж╛ржарж╛ржирзЛред

ржПржЯрж┐ Laravel-ржП ржЖржЧрзЗ ржерзЗржХрзЗржЗ рж╕рзЗржЯ ржХрж░рж╛ ржерж╛ржХрзЗред

---

### рзк. **Middleware-ржПрж░ ржорж╛ржзрзНржпржорзЗ `$next` ржлрж╛ржВрж╢ржи ржбрж╛ржЯрж╛ ржкрзНрж░рж╕рзЗрж╕ ржХрж░рзЗ:**

#### ржЙржжрж╛рж╣рж░ржг:

```php
public function handle(Request $request, Closure $next)
{
    if ($request->input('token') !== 'my-secret-token') {
        return redirect('home');
    }

    return $next($request);
}
```

ржПржЦрж╛ржирзЗ Laravel ржХрзАржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ:

1. `$next($request)` ржЖрж╕рж▓рзЗ Laravel-ржПрж░ рж░рж╛ржЙржЯ ржмрж╛ ржЕржирзНржп middleware ржХрзЗ ржмрж▓рзЗ, "ржПржЗ рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ ржарж┐ржХ ржЖржЫрзЗ, ржПржЯрж┐ ржкрзНрж░рж╕рзЗрж╕ ржХрж░ред"
2. `$next` Laravel-ржПрж░ рж░рж╛ржЙржЯ ржкрзНрж░рж╕рзЗрж╕рж┐ржВ рж▓ржЬрж┐ржХ ржерзЗржХрзЗ ржЖрж╕рзЗред

---

### рзл. **Laravel-ржП `Closure` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╕ржорзНржнржм ржХрзЗржи?**

Laravel-ржП `Closure`-ржПрж░ ржмрзНржпржмрж╣рж╛рж░ рж╕ржорзНржнржм ржХрж╛рж░ржг:

1. PHP 5.3 ржерзЗржХрзЗ `Closure` ржлрж┐ржЪрж╛рж░ржЯрж┐ ржПрж╕рзЗржЫрзЗ, ржпрж╛ ржлрзНрж░рзЗржоржУржпрж╝рж╛рж░рзНржХрзЗ ржлрж╛ржВрж╢ржи ржкрж╛рж╕ ржХрж░рж╛ рж╕рж╣ржЬ ржХрж░рзЗред
2. Laravel рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ржнрж╛ржмрзЗ `$next` рж╣рж┐рж╕рзЗржмрзЗ `Closure` ржкрж╛рж╕ ржХрж░рзЗред

Laravel-ржПрж░ ржорждрзЛ ржлрзНрж░рзЗржоржУржпрж╝рж╛рж░рзНржХ `Closure`-ржПрж░ рж╕рзБржмрж┐ржзрж╛ ржирзЗржпрж╝ ржХрж╛рж░ржг ржПржЯрж┐ **ржбрж╛ржЗржирж╛ржорж┐ржХ ржПржмржВ ржлрзНрж▓рзЗржХрзНрж╕рж┐ржмрж▓**ред ржПрж░ ржорж╛ржзрзНржпржорзЗ middleware ржЪрзЗржЗржи рждрзИрж░рж┐ ржХрж░рж╛ рж╕рж╣ржЬ рж╣ржпрж╝ред

---

### рж╕рж╣ржЬ ржнрж╛рж╖рж╛ржпрж╝ ржмрзНржпрж╛ржЦрзНржпрж╛:

-   **`Closure` рж╣рж▓ ржирж╛ржорж╣рзАржи ржлрж╛ржВрж╢ржи** ржпрж╛ Laravel-ржП ржЖржЧрзЗ ржерзЗржХрзЗржЗ рждрзИрж░рж┐ ржЖржЫрзЗред
-   **`$next` ржлрж╛ржВрж╢ржи Laravel-ржП ржЕржЯрзЛржорзЗржЯрж┐ржХ ржХрж╛ржЬ ржХрж░рзЗ**, рждрж╛ржЗ ржПржЯрж┐ ржЖрж▓рж╛ржжрж╛ ржХрж░рзЗ ржбрж┐ржлрж╛ржЗржи ржХрж░рждрзЗ рж╣ржпрж╝ ржирж╛ред
-   Laravel рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ рж╣рзНржпрж╛ржирзНржбрж▓ ржХрж░рж╛рж░ рж╕ржоржпрж╝ `$next` ржлрж╛ржВрж╢ржирзЗрж░ ржорж╛ржзрзНржпржорзЗ ржкрж░ржмрж░рзНрждрзА middleware ржмрж╛ рж░рж╛ржЙржЯ-ржП рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ ржкрж╛ржарж╛ржпрж╝ред

рж╣рзНржпрж╛ржБ, **`Closure`** ржЖрж╕рж▓рзЗ PHP-ржПрж░ ржПржХржЯрж┐ ржмрж┐рж▓рзНржЯ-ржЗржи ржХрзНрж▓рж╛рж╕ред Laravel-ржП ржЖржорж░рж╛ ржпржЦржи `Closure` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж┐, рждржЦржи ржЖржорж░рж╛ PHP-ржПрж░ ржПржЗ ржмрж┐рж▓рзНржЯ-ржЗржи **`Closure` ржХрзНрж▓рж╛рж╕** ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржЫрж┐ред ржПржЯрж┐ PHP-рждрзЗ **ржПржирзЛржирж┐ржорж╛рж╕ ржлрж╛ржВрж╢ржи** ржмрж╛ **ржирж╛ржорж╣рзАржи ржлрж╛ржВрж╢ржи** рждрзИрж░рж┐ ржХрж░рж╛рж░ ржЬржирзНржп ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝ред

---

### **PHP-ржПрж░ `Closure` ржХрзНрж▓рж╛рж╕**

`Closure` рж╣рж▓ PHP-рждрзЗ ржПржХржЯрж┐ **ржмрж┐рж╖рзЗрж╢ ржзрж░ржирзЗрж░ ржХрзНрж▓рж╛рж╕**, ржпрж╛ ржПржХржЯрж┐ ржПржирзЛржирж┐ржорж╛рж╕ ржлрж╛ржВрж╢ржиржХрзЗ ржПржХржЯрж┐ ржЕржмржЬрзЗржХрзНржЯ рж╣рж┐рж╕рзЗржмрзЗ ржХрж╛ржЬ ржХрж░рждрзЗ ржжрзЗржпрж╝ред

#### **PHP ржбржХрзБржорзЗржирзНржЯрзЗрж╢ржи ржЕржирзБржпрж╛ржпрж╝рзА:**

-   `Closure` рж╣рж▓ PHP-ржПрж░ ржПржХржЯрж┐ ржлрж╛ржЗржирж╛рж▓ ржХрзНрж▓рж╛рж╕, ржпрж╛ ржПржирзЛржирж┐ржорж╛рж╕ ржлрж╛ржВрж╢ржирзЗрж░ ржЬржирзНржп ржмрзНржпржмрж╣рзГржд рж╣ржпрж╝ред
-   ржПржЯрж┐ ржмрж┐ржнрж┐ржирзНржи ржлрж╛ржВрж╢ржирж╛рж▓ ржкрзНрж░рзЛржЧрзНрж░рж╛ржорж┐ржВ ржХрзМрж╢рж▓ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржжрзЗржпрж╝ред

---

### **Laravel-ржП `Closure` ржХрж┐ржнрж╛ржмрзЗ ржЖрж╕рзЗ?**

Laravel ржПрж░ ржорждрзЛ ржлрзНрж░рзЗржоржУржпрж╝рж╛рж░рзНржХ ржПржЗ PHP-ржПрж░ `Closure` ржХрзНрж▓рж╛рж╕ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ middleware-ржПрж░ ржорждрзЛ ржХрж╛ржЬржЧрзБрж▓рзЛржХрзЗ рж╕рж╣ржЬ ржПржмржВ ржбрж╛ржЗржирж╛ржорж┐ржХ ржХрж░рзЗред ржпржЦржи Laravel `Closure` ржкрж╛рж╕ ржХрж░рзЗ (ржпрзЗржоржи `Closure $next`), рждржЦржи ржПржЯрж┐ ржПржХржЯрж┐ **ржПржирзЛржирж┐ржорж╛рж╕ ржлрж╛ржВрж╢ржирзЗрж░** рж░рзЗржлрж╛рж░рзЗржирзНрж╕ рж╣рж┐рж╕рзЗржмрзЗ ржХрж╛ржЬ ржХрж░рзЗред

---

### **`Closure` ржХрзНрж▓рж╛рж╕рзЗрж░ ржЙржжрж╛рж╣рж░ржг**

#### рж╕рж╛ржзрж╛рж░ржг PHP-рждрзЗ `Closure`:

```php
$greet = function ($name) {
    return "Hello, $name!";
};

// ржПржЯрж┐ ржЖрж╕рж▓рзЗ `Closure` ржХрзНрж▓рж╛рж╕рзЗрж░ ржПржХржЯрж┐ ржЗржирж╕рзНржЯрзНржпрж╛ржирзНрж╕
var_dump($greet instanceof Closure); // true

echo $greet("John"); // ржЖржЙржЯржкрзБржЯ: Hello, John!
```

#### Laravel Middleware-ржП `Closure`:

Laravel-ржПрж░ middleware-ржП ржЖржорж░рж╛ `Closure $next` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж┐, ржпрзЗржЯрж┐ PHP-ржПрж░ `Closure` ржХрзНрж▓рж╛рж╕рзЗрж░ржЗ ржПржХржЯрж┐ ржЕржмржЬрзЗржХрзНржЯред

```php
public function handle(Request $request, Closure $next)
{
    // ржХрж┐ржЫрзБ ржХрж╛рж╕рзНржЯржо ржЪрзЗржХ
    if (!$request->has('token')) {
        return redirect('home');
    }

    // `$next` рж╣ржЪрзНржЫрзЗ `Closure` ржХрзНрж▓рж╛рж╕рзЗрж░ ржЗржирж╕рзНржЯрзНржпрж╛ржирзНрж╕
    return $next($request);
}
```

---

### **`Closure` ржХрзНрж▓рж╛рж╕рзЗрж░ ржХрзНрж╖ржорждрж╛**

`Closure` ржХрзНрж▓рж╛рж╕ ржЖржкржирж╛ржХрзЗ ржирж┐ржорзНржирж▓рж┐ржЦрж┐ржд ржХрзНрж╖ржорждрж╛ ржжрзЗржпрж╝:

1. **ржирж╛ржорж╣рзАржи ржлрж╛ржВрж╢ржи рждрзИрж░рж┐ ржХрж░рж╛:**
    - ржлрж╛ржВрж╢ржирзЗрж░ ржЬржирзНржп ржХрзЛржирзЛ ржирж╛ржо ржжрж┐рждрзЗ рж╣ржпрж╝ ржирж╛ред
    - рж╕рж░рж╛рж╕рж░рж┐ ржХрзЛржбрзЗ ржлрж╛ржВрж╢ржи ржбрж┐ржлрж╛ржЗржи ржХрж░рж╛ ржпрж╛ржпрж╝ред
2. **ржлрж╛ржВрж╢ржиржХрзЗ ржнрзЗрж░рж┐ржпрж╝рзЗржмрж▓ рж╣рж┐рж╕рзЗржмрзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛:**
    - ржлрж╛ржВрж╢ржиржХрзЗ ржПржХржЯрж┐ ржнрзЗрж░рж┐ржпрж╝рзЗржмрж▓рзЗ рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рж╛ ржпрж╛ржпрж╝ред
    - ржкрж░ржмрж░рзНрждрзАрждрзЗ рж╕рзЗржЗ ржнрзЗрж░рж┐ржпрж╝рзЗржмрж▓ ржжрж┐ржпрж╝рзЗ ржлрж╛ржВрж╢ржи ржХрж▓ ржХрж░рж╛ ржпрж╛ржпрж╝ред
3. **ржбрж╛ржЗржирж╛ржорж┐ржХ ржкрзНрж░рж╕рзЗрж╕рж┐ржВ:**
    - Laravel-ржПрж░ ржорждрзЛ ржлрзНрж░рзЗржоржУржпрж╝рж╛рж░рзНржХрзЗ `Closure` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржбрж╛ржЗржирж╛ржорж┐ржХ middleware ржЪрзЗржЗржи рждрзИрж░рж┐ ржХрж░рж╛ рж╣ржпрж╝ред

---

### Laravel-ржП `Closure` ржУ `Closure $next` рж╕ржорзНржкрж░рзНржХ

Laravel-ржП:

-   **`Closure` ржХрзНрж▓рж╛рж╕** ржорзВрж▓ржд PHP-ржПрж░ ржПржХржЯрж┐ ржлрж┐ржЪрж╛рж░, ржпрзЗржЯрж┐ Laravel middleware-ржПрж░ ржЬржирзНржп ржПржХржЯрж┐ ржлрж╛ржЙржирзНржбрзЗрж╢ржи рждрзИрж░рж┐ ржХрж░рзЗред
-   **`Closure $next`** Laravel-ржПрж░ рждрзИрж░рж┐ ржХрж░рж╛ ржПржХржЯрж┐ ржлрж╛ржВрж╢ржи (ржирж╛ржорж╣рзАржи), ржпрж╛ middleware ржЪрзЗржЗржирзЗрж░ ржкрж░ржмрж░рзНрждрзА ржзрж╛ржкрзЗ рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ ржкрж╛ржарж╛ржирзЛрж░ ржХрж╛ржЬ ржХрж░рзЗред

---

### рж╕рж╣ржЬ ржХржерж╛ржпрж╝:

-   рж╣рзНржпрж╛ржБ, **`Closure` ржПржХржЯрж┐ PHP ржмрж┐рж▓рзНржЯ-ржЗржи ржХрзНрж▓рж╛рж╕ред**
-   Laravel ржПржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ middleware-ржПрж░ ржоржзрзНржпрзЗ ржХрж╛ржЬржЧрзБрж▓рзЛ ржбрж╛ржЗржирж╛ржорж┐ржХржнрж╛ржмрзЗ ржкрзНрж░рж╕рзЗрж╕ ржХрж░рждрзЗред
-   ржЖржкржирж╛рж░ рж╕рж░рж╛рж╕рж░рж┐ ржПржЗ ржХрзНрж▓рж╛рж╕ рждрзИрж░рж┐ ржХрж░рж╛рж░ ржжрж░ржХрж╛рж░ ржирзЗржЗ, Laravel ржПржЯрж┐ ржЖржкржирж╛рж░ ржЬржирзНржп рждрзИрж░рж┐ ржХрж░рзЗ ржПржмржВ `$next` рж╣рж┐рж╕рзЗржмрзЗ ржкрж╛рж╕ ржХрж░рзЗред
    ржЕржмрж╢рзНржпржЗ! ржирж┐ржЪрзЗ ржПржХржЯрж┐ ржЙржжрж╛рж╣рж░ржг ржжрж┐ржЪрзНржЫрж┐ ржпрзЗржЦрж╛ржирзЗ ржЖржорж░рж╛ PHP-рждрзЗ **`Closure` ржХрзНрж▓рж╛рж╕** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗржЫрж┐ред ржПрждрзЗ `Closure` ржХрзНрж▓рж╛рж╕ ржХрзАржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ ржПржмржВ ржПржЯрж┐ ржХрзАржнрж╛ржмрзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ ржпрж╛ржпрж╝, рждрж╛ ржмрзЛржЭрж╛ ржпрж╛ржмрзЗред

---

### **Closure ржХрзНрж▓рж╛рж╕рзЗрж░ ржЙржжрж╛рж╣рж░ржг:**

```php
<?php

// ржПржХржЯрж┐ рж╕рж╛ржзрж╛рж░ржг ржирж╛ржорж╣рзАржи ржлрж╛ржВрж╢ржи рждрзИрж░рж┐ ржХрж░рж╛ (Closure)
$greet = function ($name) {
    return "Hello, $name!";
};

// Closure ржХрж▓ ржХрж░рж╛
echo $greet("John"); // ржЖржЙржЯржкрзБржЯ: Hello, John!

// Closure ржХрзНрж▓рж╛рж╕рзЗрж░ ржПржХржЯрж┐ ржмрж┐рж▓рзНржЯ-ржЗржи ржорзЗржержб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛: bindTo()
// bindTo() ржжрж┐рзЯрзЗ ржЖржорж░рж╛ ржПржХржЯрж┐ ржлрж╛ржВрж╢ржирзЗрж░ рж╕рзНржХрзЛржк ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рждрзЗ ржкрж╛рж░рж┐
class Person
{
    public $name;
    public function __construct($name)
    {
        $this->name = $name;
    }
}

$person = new Person("Jane");

// Closure рждрзИрж░рж┐
$showName = function () {
    return "This is {$this->name}'s function!";
};

// Closure-ржХрзЗ ржПржХржЯрж┐ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржЕржмржЬрзЗржХрзНржЯрзЗ ржмрзЗржБржзрзЗ ржжрзЗржУрзЯрж╛ (рж╕рзНржХрзЛржк рж╕рзЗржЯ ржХрж░рж╛)
$boundClosure = $showName->bindTo($person, Person::class);

// ржПржЦржи $boundClosure ржХрж▓ ржХрж░рж▓рзЗ ржПржЯрж┐ $person ржЕржмржЬрзЗржХрзНржЯ ржерзЗржХрзЗ ржбрж╛ржЯрж╛ ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗ
echo $boundClosure(); // ржЖржЙржЯржкрзБржЯ: This is Jane's function!

?>
```

---

### **ржХрзЛржб ржмрзНржпрж╛ржЦрзНржпрж╛:**

1. **ржирж╛ржорж╣рзАржи ржлрж╛ржВрж╢ржи (Closure):**

    ```php
    $greet = function ($name) {
        return "Hello, $name!";
    };
    echo $greet("John");
    ```

    - ржПржЦрж╛ржирзЗ `$greet` ржПржХржЯрж┐ ржирж╛ржорж╣рзАржи ржлрж╛ржВрж╢ржи, ржпрзЗржЯрж┐ `Closure` ржХрзНрж▓рж╛рж╕рзЗрж░ ржПржХржЯрж┐ ржЗржирж╕рзНржЯрзНржпрж╛ржирзНрж╕ред
    - ржПржЯрж┐ рж╕рж░рж╛рж╕рж░рж┐ `$name` ржкрзНржпрж╛рж░рж╛ржорж┐ржЯрж╛рж░ ржирж┐ржпрж╝рзЗ ржЖржЙржЯржкрзБржЯ ржжрж┐ржЪрзНржЫрзЗред

2. **`Closure::bindTo()` ржмрзНржпржмрж╣рж╛рж░:**

    ```php
    $showName->bindTo($person, Person::class);
    ```

    - `bindTo()` ржорзЗржержб ржжрж┐ржпрж╝рзЗ ржЖржорж░рж╛ ржПржХржЯрж┐ `Closure`-ржПрж░ рж╕рзНржХрзЛржк ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рждрзЗ ржкрж╛рж░рж┐ред
    - ржПржЦрж╛ржирзЗ `$showName` ржлрж╛ржВрж╢ржиржХрзЗ `$person` ржЕржмржЬрзЗржХрзНржЯрзЗ ржмрзЗржБржзрзЗ ржжрзЗржУржпрж╝рж╛ рж╣ржпрж╝рзЗржЫрзЗ, ржпрж╛рждрзЗ ржПржЯрж┐ `$this->name` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░рзЗред

3. **ржЖржЙржЯржкрзБржЯ:**
    - ржкрзНрж░ржержорзЗ "Hello, John!" ржжрзЗржЦрж╛ржмрзЗред
    - ржПрж░ржкрж░ `$person`-ржПрж░ `name` ржкрзНрж░ржкрж╛рж░рзНржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ "This is Jane's function!" ржжрзЗржЦрж╛ржмрзЗред

---

### **Closure ржХрзНрж▓рж╛рж╕рзЗрж░ ржмрзИрж╢рж┐рж╖рзНржЯрзНржп:**

-   **ржирж╛ржорж╣рзАржи ржлрж╛ржВрж╢ржи рждрзИрж░рж┐ ржХрж░рж╛ ржпрж╛рзЯред**
-   **`bindTo()` ржорзЗржержб ржжрж┐рзЯрзЗ рж╕рзНржХрзЛржк ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рж╛ ржпрж╛рзЯред**
-   **Laravel-ржПрж░ ржорждрзЛ ржлрзНрж░рзЗржоржУржпрж╝рж╛рж░рзНржХрзЗ middleware ржПржмржВ ржХрж▓ржмрзНржпрж╛ржХ рж╣рзНржпрж╛ржирзНржбрж▓рж┐ржВ рж╕рж╣ржЬ ржХрж░рзЗред**

ржПржЯрж┐ ржХрж┐ ржЖржкржирж╛рж░ ржЬржирзНржп ржмрзЛржзржЧржорзНржп рж╣ржпрж╝рзЗржЫрзЗ? ЁЯШК
